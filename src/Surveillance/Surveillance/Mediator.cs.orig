using Surveillance.Services.Interfaces;
using System;
using Surveillance.Interfaces;
using Surveillance.Scheduler.Interfaces;

namespace Surveillance
{
    /// <summary>
    /// The mediator orchestrates program components; factory; services; display
    /// This represents the root entry into the 'real' surveillance object graph
    /// </summary>
    public class Mediator : IMediator
    {
        private readonly IReddeerTradeService _reddeerTradeService;
        private readonly IReddeerRuleScheduler _ruleScheduler;
        private readonly IReddeerDistributedRuleScheduler _distributedRuleScheduler;
        private readonly IApplicationHeartbeatService _heartbeatService;
<<<<<<< HEAD
        private readonly IDeadLetterQueueService _deadLetterQueueService;
=======
        private readonly IEnrichmentService _enrichmentService;
>>>>>>> RDPB-2990 updated enrichment api repository and services to now enrich in blocks of 10k rows with a cosntant stream of updates if theres more to be done to protect against post max length limits on web servers.

        public Mediator(
            IReddeerTradeService reddeerTradeService,
            IReddeerRuleScheduler ruleScheduler,
            IReddeerDistributedRuleScheduler distributedRuleScheduler,
            IApplicationHeartbeatService heartbeatService,
<<<<<<< HEAD
            IDeadLetterQueueService deadLetterQueueService)
=======
            IEnrichmentService enrichmentService)
>>>>>>> RDPB-2990 updated enrichment api repository and services to now enrich in blocks of 10k rows with a cosntant stream of updates if theres more to be done to protect against post max length limits on web servers.
        {
            _reddeerTradeService =
                reddeerTradeService 
                ?? throw new ArgumentNullException(nameof(reddeerTradeService));
            _ruleScheduler =
                ruleScheduler
                ?? throw new ArgumentNullException(nameof(ruleScheduler));
            _distributedRuleScheduler =
                distributedRuleScheduler
                ?? throw new ArgumentNullException(nameof(distributedRuleScheduler));
            _heartbeatService =
                heartbeatService
                ?? throw new ArgumentNullException(nameof(heartbeatService));
<<<<<<< HEAD
            _deadLetterQueueService =
                deadLetterQueueService
                ?? throw new ArgumentNullException(nameof(deadLetterQueueService));
=======
            _enrichmentService =
                enrichmentService
                ?? throw new ArgumentNullException(nameof(enrichmentService));
>>>>>>> RDPB-2990 updated enrichment api repository and services to now enrich in blocks of 10k rows with a cosntant stream of updates if theres more to be done to protect against post max length limits on web servers.
        }

        public void Initiate()
        {
            _distributedRuleScheduler.Initiate();
            _ruleScheduler.Initiate();
            _reddeerTradeService.Initialise();
            _heartbeatService.Initialise();
<<<<<<< HEAD
            _deadLetterQueueService.Initialise();
=======
            _enrichmentService.Initialise();
>>>>>>> RDPB-2990 updated enrichment api repository and services to now enrich in blocks of 10k rows with a cosntant stream of updates if theres more to be done to protect against post max length limits on web servers.
        }

        public void Terminate()
        {
            _reddeerTradeService.Dispose();
            _ruleScheduler.Terminate();
            _distributedRuleScheduler.Terminate();
<<<<<<< HEAD
            _deadLetterQueueService.Terminate();
=======
            _enrichmentService.Terminate();
>>>>>>> RDPB-2990 updated enrichment api repository and services to now enrich in blocks of 10k rows with a cosntant stream of updates if theres more to be done to protect against post max length limits on web servers.
            // we don't terminate the heart beat service as it will stop when the entire app has stopped
        }
    }
}
